# Step1 Report

## 2018011423 任一

### 实验内容

在本次实验中，我完整阅读并学习了实验参考书中的内容。具体来说有配置环境，学习词法分析、语法分析等概念，学习ANTLR的使用、学习Visitor设计模式和IR表示。



在实验代码中，我做了词法分析、语法分析、IR生成和最后的汇编生成这4步，每一步都有特定的类负责完成，并且加入了**详细的注释**，代码风格较为**OOP**，具有良好的**可扩展性和可读性**。Step1要求解析仅含return的main函数，词法分析和语法分析用ANTLR工具即可完成，我主要做的部分是通过继承MiniDecafVisitor，捕捉程序中的return statement和整数，从而生成IR表示，再从IR表示进一步生成汇编代码。



本次实验的主要难点在于，学习编程框架和各种工具的使用。尤其是Python框架，参考实现的Step1的Commit并不能正常运行，需要对参考实现进行更为细致的学习。此外，ANTLR工具以及Visitor设计模式也是学习的难点。



### 思考题

1. Q: 修改 `minilexer`的输入（`lexer.setInput` 的参数），使得 `lex` 报错，给出一个简短的例子。

   A: 修改输入为中文字符即可使`lex`报错，例如输入"汉字"这两个中文字符，`lex`就会报错。

   

2. Q: 修改 `minilexer` 的输入，使得 `lex` 不报错但 `parser` 报错，给出一个简短的例子。

   A: 修改输入为`int main() {return ;}`即可使得`lex`不报错而`parser`报错

   

3. Q: 在riscv 中，哪个寄存器是用来存储函数返回值的？

   A: `a0`寄存器在riscv中用来保存函数返回值





### 复用代码情况

在本次实验中，我的整体框架参考了助教的实现，即词法分析、语法分析、IR生成和代码生成的流程与助教的实现很接近，各个类的设置也与助教的框架较为接近。但我并**不是完全照搬**了助教的实现，一方面是助教Python框架Step1的commit**不能正常运行**，另一方面我经过了仔细的阅读和思考，认为助教的框架设置很合理，具有很强的**可扩展性和可读性**，所以做了进行了参考，并且在我的代码每个类和关键函数中，做了**详细的注释**。



此外，关于ANTLR的词法和语法文件，我也主要参考了助教的实现。因为这部分**内容较为固定**，无需做很大的更改，经过阅读并理解后我直接使用了助教在step1使用的语法和词法文件。